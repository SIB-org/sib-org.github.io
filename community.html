<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SIB Community</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<header class="big-ribbon-header">
  <div class="ribbon-top">
    <img src="Logos/SIB Logo Wordmark.png" alt="SIB Logo">
  </div>
  <div class="ribbon-bottom">
    <h1>Student Initiative Board</h1>
    <p>An interschool academic organisation</p>
    <nav>
  <a href="index.html" class="hidden">Home</a>
  <a href="about.html">| About |</a>
  <a href="upcoming.html">| Upcoming Events |</a>
  <a href="past_events.html">| Past Events |</a>
  <a href="join.html">| Join SIB |</a>
  <a href="SWC.html">| SWC |</a>
  <a href="our_team.html">| Our Team |</a>
  <a href="blogs.html">| Blogs |</a>
  <a href="community.html">| Community |</a>
</nav>
  </div>
</header>
<style>
body { font-family:'Poppins',sans-serif; background:#f5f5f5; margin:0; padding:20px;}
h1 { text-align:center;}
#auth,#comment-form,#people-list { max-width:700px; margin:10px auto; background:#fff; padding:20px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.1);}
#comments { max-width:700px; margin:20px auto;}
.comment { background:#fff; padding:15px; margin-bottom:15px; border-radius:10px; box-shadow:0 4px 10px rgba(0,0,0,0.1); position:relative;}
.comment small { color:#555; display:block; margin-bottom:5px;}
.admin-label { color:red; font-weight:bold; margin-left:5px;}
button { padding:8px 12px; border:none; border-radius:6px; background:#007BFF; color:#fff; cursor:pointer;}
button:hover { background:#0056b3;}
input,textarea,select { width:100%; padding:8px; margin-bottom:10px; border-radius:6px; border:1px solid #ccc;}
#delete-account { background:#FF4C4C; margin-top:10px;}
</style>
</head>
<body>
<h1>SIB Community</h1>
<div id="auth">
<input type="text" id="username" placeholder="Username">
<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">
<button id="login">Login</button>
<button id="register">Register</button>
<button id="logout" style="display:none;">Logout</button>
<button id="delete-account">Delete My Account</button>
</div>
<div id="comment-form" style="display:none;">
<textarea id="comment" placeholder="Write your comment..."></textarea>
<button id="post-comment">Post Comment</button>
</div>
<div id="people-list" style="display:none;">
<h3>All Users</h3>
<div id="users-container"></div>
</div>
<div id="comments"></div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, signInWithEmailAndPassword, onAuthStateChanged, signOut, deleteUser } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
import { getFirestore, collection, addDoc, serverTimestamp, onSnapshot, query, orderBy, doc, getDoc, setDoc, updateDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyBhYQ5C5KgsvpihD_6NneRzqVupdiHImB8",
authDomain: "sibonlinehubcommunity.firebaseapp.com",
projectId: "sibonlinehubcommunity",
storageBucket: "sibonlinehubcommunity.firebasestorage.app",
messagingSenderId: "715051010435",
appId: "1:715051010435:web:c51d3994c0b2c0602e4eb6",
measurementId: "G-P1M7EF6PF6"
};

const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
const auth = getAuth(app);
const db = getFirestore(app);

const usernameInput=document.getElementById('username');
const emailInput=document.getElementById('email');
const passwordInput=document.getElementById('password');
const loginBtn=document.getElementById('login');
const registerBtn=document.getElementById('register');
const logoutBtn=document.getElementById('logout');
const deleteBtn=document.getElementById('delete-account');
const commentForm=document.getElementById('comment-form');
const commentInput=document.getElementById('comment');
const postBtn=document.getElementById('post-comment');
const commentsDiv=document.getElementById('comments');
const peopleList=document.getElementById('people-list');
const usersContainer=document.getElementById('users-container');

let currentUser=null;
let isAdmin=false;
const adminEmails=['meetayaand@gmail.com','meetayaand@Gmail.com'];

async function checkAdmin(user){ isAdmin=adminEmails.includes(user.email); }

async function loadUsers(){
usersContainer.innerHTML='';
const usersSnap=await getDocs(collection(db,'users'));
usersSnap.forEach(docSnap=>{
const data=docSnap.data();
const div=document.createElement('div');
div.style.border="1px solid #ccc"; div.style.padding="8px"; div.style.margin="5px 0"; div.style.borderRadius="6px";
const adminTag=adminEmails.includes(data.email)?'<span class="admin-label">Admin</span>':'';
div.innerHTML=`<strong>${data.displayName||'(no username)'}</strong>${adminTag} | ${data.role||'Member'}`;
if(isAdmin){
const nameInputEl=document.createElement('input'); nameInputEl.placeholder='Username'; nameInputEl.value=data.displayName||'';
const roleSelect=document.createElement('select');
['Member','Tech Team','CEO','CTO','Executive Board','Marketing','Media Team'].forEach(r=>{
const opt=document.createElement('option'); opt.value=r; opt.text=r; if(r===data.role) opt.selected=true; roleSelect.appendChild(opt);
});
const saveBtn=document.createElement('button'); saveBtn.textContent='Save';
saveBtn.addEventListener('click',async()=>{
const password=prompt('Admin password:'); if(password!=='sib@2000') return alert('Wrong password');
await updateDoc(doc(db,'users',docSnap.id),{displayName:nameInputEl.value,role:roleSelect.value});
loadUsers();
});
div.appendChild(document.createElement('br'));
div.appendChild(nameInputEl); div.appendChild(roleSelect); div.appendChild(saveBtn);
}
usersContainer.appendChild(div);
});
}

registerBtn.addEventListener('click',async()=>{
try{
const cred=await createUserWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
await setDoc(doc(db,'users',cred.user.uid),{email:cred.user.email,displayName:usernameInput.value,role:'Member'});
await sendEmailVerification(cred.user);
alert('Registered! Check your email to verify your account.');
}catch(e){alert(e.message);}
});

loginBtn.addEventListener('click',async()=>{
try{
await signInWithEmailAndPassword(auth,emailInput.value,passwordInput.value);
}catch(e){alert(e.message);}
});

logoutBtn.addEventListener('click',async()=>{await signOut(auth);});

onAuthStateChanged(auth,async(user)=>{
currentUser=user;
if(user && user.emailVerified){
commentForm.style.display='block'; logoutBtn.style.display='inline-block'; loginBtn.style.display='none'; registerBtn.style.display='none';
await checkAdmin(user);
if(isAdmin) peopleList.style.display='block'; else peopleList.style.display='none';
if(isAdmin) loadUsers();
}else{
commentForm.style.display='none'; logoutBtn.style.display='none'; loginBtn.style.display='inline-block'; registerBtn.style.display='inline-block';
peopleList.style.display='none';
}
});

postBtn.addEventListener('click',async()=>{
if(!currentUser) return alert('Login first');
const msg=commentInput.value.trim(); if(msg==='') return;
const userRef=doc(db,'users',currentUser.uid);
const userSnap=await getDoc(userRef);
let displayName=userSnap.exists()?userSnap.data().displayName:usernameInput.value||'Anonymous';
let role=adminEmails.includes(currentUser.email)?'Admin':(userSnap.exists()?userSnap.data().role:'Member');
await addDoc(collection(db,'comments'),{
user:displayName,
role:role,
message:msg,
timestamp:serverTimestamp()
});
commentInput.value='';
});

const commentsQuery=query(collection(db,'comments'),orderBy('timestamp','asc'));
onSnapshot(commentsQuery,snapshot=>{
commentsDiv.innerHTML='';
snapshot.forEach(docSnap=>{
const data=docSnap.data();
const div=document.createElement('div');
div.classList.add('comment');
const adminTag=data.role==='Admin'?'<span class="admin-label">Admin</span>':'';
div.innerHTML=`<small>${data.user}${adminTag} (${data.role}) | ${data.timestamp?.toDate().toLocaleString()||''}</small><p>${data.message}</p>`;
if(isAdmin){
const delBtn=document.createElement('button');
delBtn.textContent='Delete Comment';
delBtn.addEventListener('click',async()=>{await deleteDoc(doc(db,'comments',docSnap.id));});
div.appendChild(delBtn);
}
commentsDiv.appendChild(div);
});
});

deleteBtn.addEventListener('click',async()=>{
if(!currentUser) return alert('Login first');
if(!confirm('Are you sure to delete your account?')) return;
await deleteDoc(doc(db,'users',currentUser.uid));
await deleteUser(currentUser);
});
</script>
</body>
</html>
